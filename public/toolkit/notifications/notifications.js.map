{"version":3,"sources":["webpack://SFNotifications/webpack/universalModuleDefinition","webpack://SFNotifications/webpack/bootstrap","webpack://SFNotifications/external {\"root\":\"SFToolkit\",\"commonjs\":\"@spiral-toolkit/core\",\"amd\":\"@spiral-toolkit/core\",\"commonjs2\":\"@spiral-toolkit/core\"}","webpack://SFNotifications/O:/Projects/SF/toolkit/node_modules/@spiralscout/websockets/build/socket.js","webpack://SFNotifications/./src/Notifications.ts","webpack://SFNotifications/./src/item.ts","webpack://SFNotifications/./src/constants.ts","webpack://SFNotifications/./src/index.ts"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__0__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","e","default","TypeError","configurable","this","CONNECTED","MESSAGE","CONNECTING","DISCONNECTED","ERROR","OPEN","INITIALIZED","CLOSED","UNAVAILABLE","CHANNEL_JOINED","CHANNEL_JOIN_FAILED","CHANNEL_LEFT","arguments","length","getOwnPropertyDescriptor","Reflect","decorate","a","JOINING","JOINED","LEAVING","channelStatus","selfName","socket","cMgr","enabled","isConnected","startListening","sendJoinCommand","unbind","sendLeave","stopListening","indexOf","sendJoin","onDisconnect","onJoinFailed","onJoin","onLeft","onConnect","host","port","path","unavailableTimeout","retryTimeout","useTLS","callbacks","push","fn","channel","keys","removeCallback","removeAllCallbacks","forEach","filter","h","add","remove","context","CHANNEL_LEAVE_FAILED","u","Set","E","topic","type","payload","JSON","stringify","N","JOIN","LEAVE","C","b","super","id","transport","bindListeners","send","has","Error","close","message","error","closed","parse","Array","isArray","data","emit","code","handleCloseEvent","console","initialize","hooks","isInitialized","changeState","onClose","state","url","getSocket","setTimeout","onError","onClosed","toString","onopen","onerror","onclose","onmessage","currentTarget","wasClean","reason","unbindListeners","onOpen","onMessage","L","options","queryParams","entries","map","encodeURIComponent","join","WebSocket","connect","abort","O","connection","errorCallbacks","buildErrorCallbacks","connectionCallbacks","buildConnectionCallbacks","runner","unavailableTimer","retryTimer","updateState","startConnecting","setUnavailableTimer","sendCommand","disconnectInternally","abandonConnection","shouldRetry","retryIn","abortConnecting","clearUnavailableTimer","setConnection","clearRetryTimer","String","Math","round","clearTimeout","channelJoined","channelJoinFailed","channelLeft","refused","disconnect","unavailable","f","channels","config","values","instances","isReady","joinChannel","leaveChannel","leave","y","URL","protocol","replace","hostname","ssf","node","Notifications","defaultOptions","spiralFrameworkName","optionsToGrab","unreadCount","selected","init","toastTemplate","helpers","template","compile","ui","drawer","body","document","querySelector","container","counter","mask","btn","header","toggle","initWs","bindEvents","reload","toggleDrawer","classList","markSelection","addEventListener","unbindEvents","removeEventListener","calcSelected","v","find","delete","updateButton","text","size","innerHTML","ws","subscribe","event","title","isNotificationEvent","onNotification","ex","existing","findIndex","val","icon","sort","date","read","CustomEvent","bubbles","detail","position","timeout","onClick","dispatchEvent","render","ajax","method","api","getList","then","axResp","handleResponse","luxon","DateTime","fromJSDate","Date","toFormat","renderNotitifation","not","item","fr","createElement","el","firstChild","bindToast","innerText","appendChild","markAsRead","input","checked","die","setAsRead","catch","ids","spiralFrameworkCssName","core","BaseDOMConstructor","registerInstanceType","version"],"mappings":"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","file":"notifications.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@spiral-toolkit/core\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@spiral-toolkit/notifications\", [\"@spiral-toolkit/core\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@spiral-toolkit/notifications\"] = factory(require(\"@spiral-toolkit/core\"));\n\telse\n\t\troot[\"SFNotifications\"] = factory(root[\"SFToolkit\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__0__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","!function(t,n){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=n():\"function\"==typeof define&&define.amd?define([],n):\"object\"==typeof exports?exports.SFSocket=n():t.SFSocket=n()}(window,(function(){return function(t){var n={};function e(s){if(n[s])return n[s].exports;var i=n[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=n,e.d=function(t,n,s){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:s})},e.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&\"object\"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,\"default\",{enumerable:!0,value:t}),2&n&&\"string\"!=typeof t)for(var i in t)e.d(s,i,function(n){return t[n]}.bind(null,i));return s},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,\"a\",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p=\"\",e(e.s=0)}([function(t,n,e){\"use strict\";var s;function i(t,n,e){let s=e.value;if(\"function\"!=typeof s)throw new TypeError(`@autobind decorator can only be applied to methods not: ${typeof s}`);let i=!1;return{configurable:!0,get(){if(i||this===t.prototype||this.hasOwnProperty(n)||\"function\"!=typeof s)return s;const e=s.bind(this);return i=!0,Object.defineProperty(this,n,{configurable:!0,get:()=>e,set(t){s=t,delete this[n]}}),i=!1,e},set(t){s=t}}}e.r(n),function(t){t.CONNECTED=\"connected\",t.MESSAGE=\"message\",t.CONNECTING=\"connecting\",t.DISCONNECTED=\"disconnected\",t.ERROR=\"error\",t.OPEN=\"open\",t.INITIALIZED=\"initialized\",t.CLOSED=\"closed\",t.UNAVAILABLE=\"unavailable\",t.CHANNEL_JOINED=\"channel_joined\",t.CHANNEL_JOIN_FAILED=\"channel_join_failed\",t.CHANNEL_LEFT=\"channel_left\"}(s||(s={}));var o,r=function(t,n,e,s){var i,o=arguments.length,r=o<3?n:null===s?s=Object.getOwnPropertyDescriptor(n,e):s;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,s);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(r=(o<3?i(r):o>3?i(n,e,r):i(n,e))||r);return o>3&&r&&Object.defineProperty(n,e,r),r};!function(t){t.CLOSED=\"closed\",t.JOINING=\"joining\",t.JOINED=\"joined\",t.LEAVING=\"leaving\",t.ERROR=\"error\"}(o||(o={}));class a{constructor(t,n){this.channelStatus=o.CLOSED,this.selfName=t,this.socket=n,this.cMgr=n.cMgr,this.enabled=!1}get status(){return this.channelStatus}get name(){return this.selfName}get isActive(){return this.cMgr.isConnected()&&this.channelStatus===o.JOINED}join(){this.enabled||(this.enabled=!0,this.startListening(),this.cMgr.isConnected()&&this.sendJoinCommand())}subscribe(t,n){this.cMgr.bind(t,n,this.name)}unsubscribe(t,n){this.cMgr.unbind(t,n,this.name)}leave(){this.enabled&&(this.enabled=!1,this.channelStatus=o.LEAVING,this.cMgr.isConnected()&&this.cMgr.sendLeave([this.name]),this.stopListening())}onConnect(){this.enabled&&this.sendJoinCommand()}onDisconnect(){this.channelStatus=o.CLOSED}onJoin(t){t.indexOf(this.name)>=0&&(this.channelStatus=o.JOINED)}onLeft(t){t.indexOf(this.name)>=0&&(this.channelStatus=o.CLOSED)}onJoinFailed(t){t.indexOf(this.name)>=0&&(this.channelStatus=o.ERROR)}sendJoinCommand(){this.channelStatus!==o.JOINING&&(this.channelStatus=o.JOINING,this.cMgr.sendJoin([this.name]))}startListening(){this.cMgr.bind(s.DISCONNECTED,this.onDisconnect),this.cMgr.bind(s.CHANNEL_JOIN_FAILED,this.onJoinFailed),this.cMgr.bind(s.CHANNEL_JOINED,this.onJoin),this.cMgr.bind(s.CHANNEL_LEFT,this.onLeft),this.cMgr.bind(s.CONNECTED,this.onConnect)}stopListening(){this.cMgr.unbind(s.DISCONNECTED,this.onDisconnect),this.cMgr.unbind(s.CHANNEL_JOIN_FAILED,this.onJoinFailed),this.cMgr.unbind(s.CHANNEL_JOINED,this.onJoin),this.cMgr.unbind(s.CHANNEL_LEFT,this.onLeft),this.cMgr.unbind(s.CONNECTED,this.onConnect)}}r([i],a.prototype,\"onConnect\",null),r([i],a.prototype,\"onDisconnect\",null),r([i],a.prototype,\"onJoin\",null),r([i],a.prototype,\"onLeft\",null),r([i],a.prototype,\"onJoinFailed\",null);const c={host:\"\",port:80,path:\"\",unavailableTimeout:1e4,retryTimeout:1e3,useTLS:!1};class l{constructor(){this.callbacks={}}get(t){return this.callbacks[t]||[]}add(t,n,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push({fn:n,channel:e||null})}remove(t,n,e){if(!t&&!n&&!e)return void(this.callbacks={});const s=t?[t]:Object.keys(this.callbacks);n||e?this.removeCallback(s,n,e):this.removeAllCallbacks(s)}removeCallback(t,n,e){t.forEach(t=>{const s=this.callbacks[t]||[];this.callbacks[t]=s.filter(t=>{const s=n&&n===t.fn,i=e&&e===t.channel;return!s&&!i})})}removeAllCallbacks(t){t.forEach(t=>{delete this.callbacks[t]})}}class h{constructor(){this.callbacks=new l}bind(t,n,e){return this.callbacks.add(t,n,e),this}unbind(t,n,e){return this.callbacks.remove(t,n,e),this}emit(t,n){const e=this.callbacks.get(t),s=(i=n)&&i.context&&\"string\"==typeof i.context.channel?n.context.channel:null;var i;return e&&e.length>0&&e.forEach(t=>{const e=t.channel===s;(!t.channel||!s||e)&&t.fn(n)}),this}}var d;!function(t){t.CHANNEL_JOINED=\"@join\",t.CHANNEL_JOIN_FAILED=\"#join\",t.CHANNEL_LEFT=\"@leave\",t.CHANNEL_LEAVE_FAILED=\"#leave\"}(d||(d={}));const u=new Set([d.CHANNEL_JOINED,d.CHANNEL_JOIN_FAILED,d.CHANNEL_LEFT,d.CHANNEL_LEAVE_FAILED]),E=t=>{const n={topic:t.type,payload:t.payload};return JSON.stringify(n)};var N;!function(t){t.JOIN=\"join\",t.LEAVE=\"leave\"}(N||(N={}));const C=new Set([N.JOIN,N.LEAVE]);class b extends h{constructor(t,n){super(),this.id=t,this.transport=n,this.bindListeners()}send(t){return!!this.transport&&this.transport.send(t)}sendCommand(t,n){if(C.has(t))throw new Error(`${t} is a reserved command, cant be sent manually`);return this.send(E({type:t,payload:n}))}sendJoin(t){this.send(E({type:N.JOIN,payload:t}))}sendLeave(t){this.send(E({type:N.LEAVE,payload:t}))}close(){this.transport&&this.transport.close()}bindListeners(){const t=t=>{this.transport&&(this.transport.unbind(s.MESSAGE,t.message),this.transport.unbind(s.ERROR,t.error),this.transport.unbind(s.CLOSED,t.closed))},n={message:t=>{let n=null;try{n=(t=>{if(t){const n=JSON.parse(t);if(u.has(n.topic)&&!n.payload&&Array.isArray(n.payload))return{type:m.ERROR,error:\"WS event system event payload is invalid. Should be a string array\",data:\"MessageParseError\"};switch(n.topic){case d.CHANNEL_JOINED:return{type:m.CHANNEL_JOINED,error:null,data:n.payload};case d.CHANNEL_JOIN_FAILED:return{type:m.CHANNEL_JOIN_FAILED,error:null,data:n.payload};case d.CHANNEL_LEFT:return{type:m.CHANNEL_LEFT,error:null,data:n.payload};case d.CHANNEL_LEAVE_FAILED:return{type:m.CHANNEL_LEAVE_FAILED,error:null,data:n.payload};default:return{type:m.MESSAGE,error:null,data:n.payload||null,context:{...n.topic?{channel:n.topic}:{}}}}}return{type:m.ERROR,error:\"MessageEvent has no data property\",data:\"MessageParseError\"}})(t.data)}catch(n){this.emit(s.ERROR,{type:m.ERROR,error:n,data:JSON.stringify(t)})}if(n)switch(n.type){case m.ERROR:this.emit(s.ERROR,n);break;case m.CHANNEL_JOIN_FAILED:this.emit(s.CHANNEL_JOIN_FAILED,n.data);break;case m.CHANNEL_JOINED:this.emit(s.CHANNEL_JOINED,n.data);break;case m.CHANNEL_LEFT:this.emit(s.CHANNEL_LEFT,n.data);break;case m.CHANNEL_LEAVE_FAILED:this.emit(s.ERROR,n);break;default:this.emit(s.MESSAGE,n)}},error:t=>{this.emit(s.ERROR,{...t,type:m.ERROR,data:null})},closed:e=>{var i;t(n),(i=e).context&&void 0!==i.context.code&&this.handleCloseEvent(e),this.transport=null,this.emit(s.CLOSED,e)}};this.transport&&(this.transport.bind(s.MESSAGE,n.message),this.transport.bind(s.ERROR,n.error),this.transport.bind(s.CLOSED,n.closed))}handleCloseEvent(t){const n=(t=>t.context&&t.context.code?t.context.code<4e3&&t.context.code>=1002&&t.context.code<=1004?{...t,error:\"Socket is unavailable\"}:t:(console.error(\"Socket event do not contain close code\"),{...t,error:\"Connection refused\"}))(t);n.type===m.CLOSED?this.emit(s.CLOSED,n):this.emit(s.ERROR,n)}}class p extends h{constructor(t,n){super(),this.initialize=()=>{const t=this;t.hooks.isInitialized()?t.changeState(s.INITIALIZED):t.onClose()},this.hooks=t,this.name=n,this.state=\"new\"}connect(){if(this.socket||\"initialized\"!==this.state)return!1;const{url:t}=this.hooks;try{this.socket=this.hooks.getSocket(t)}catch(t){return setTimeout(()=>{this.onError(t),this.onClosed({type:m.ERROR,data:t,error:t.toString(),context:{code:0}})}),!1}return this.bindListeners(),this.changeState(s.CONNECTING),!0}close(){return!!this.socket&&(this.socket.close(),!0)}send(t){return\"open\"===this.state&&(setTimeout(()=>{this.socket&&this.socket.send(t)}),!0)}unbindListeners(){this.socket&&(this.socket.onopen=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.onmessage=null)}onOpen(){this.changeState(s.OPEN),this.socket&&(this.socket.onopen=null)}onError(t){var n;(n=t)&&\"string\"==typeof n.type&&void 0!==n.currentTarget?this.emit(s.ERROR,{type:m.ERROR,error:\"Websocket connection error\",data:null}):this.emit(s.ERROR,{type:m.ERROR,error:t?t.message:\"Websocket connection error\",data:t?t.name:null})}onClose(t){t?this.onClosed({type:t.wasClean?m.CLOSED:m.ERROR,data:t.wasClean?t.reason:null,error:t.wasClean?null:t.reason,context:{code:t.code}}):this.onClosed({type:m.ERROR,data:null,error:\"Closed for unknown reason\",context:{code:0}}),this.unbindListeners(),this.socket=void 0}onMessage(t){this.emit(s.MESSAGE,{type:m.MESSAGE,data:\"string\"==typeof t.data?t.data:JSON.stringify(t.data),error:null})}bindListeners(){this.socket&&(this.socket.onopen=()=>{this.onOpen()},this.socket.onerror=t=>{this.onError(t)},this.socket.onclose=t=>{this.onClose(t)},this.socket.onmessage=t=>{this.onMessage(t)})}changeState(t){this.state=t,this.emit(t,void 0)}onClosed(t){this.state=s.CLOSED,this.emit(s.CLOSED,t)}}class L{constructor(t,n){this.options=n||{};const e=`ws${n.useTLS?\"s\":\"\"}`,s=`${n.host}:${n.port}`,i=n.queryParams?Object.entries(n.queryParams).map(([t,n])=>`${encodeURIComponent(t)}=${encodeURIComponent(n)}`).join(\"&\"):null,o=`${e}://${s}/${n.path}${i?`?${i}`:\"\"}`;this.hooks={url:o,isInitialized:()=>!!window.WebSocket,getSocket:t=>new WebSocket(t)},this.name=t}connect(t){let n=!1;const e=new p(this.hooks,this.name),i=()=>{e.unbind(s.INITIALIZED,i),e.connect()},o=()=>{e.unbind(s.INITIALIZED,i),e.unbind(s.OPEN,r),e.unbind(s.ERROR,a),e.unbind(s.CLOSED,c)},r=()=>{n=!0,o();const s=new b(\"\",e);t(null,s)},a=()=>{},c=n=>{o(),t(n)};return e.bind(s.INITIALIZED,i),e.bind(s.OPEN,r),e.bind(s.ERROR,a),e.bind(s.CLOSED,c),e.initialize(),{abort:()=>{n||(o(),e.close())}}}}class O extends h{constructor(t){super(),this.options={...c,...t},this.state=\"initialized\",this.connection=null,this.errorCallbacks=this.buildErrorCallbacks(),this.connectionCallbacks=this.buildConnectionCallbacks(this.errorCallbacks),this.transport=new L(\"ws\",t),this.runner=null,this.unavailableTimer=0,this.retryTimer=0}connect(){this.connection||this.runner||(this.updateState(s.CONNECTING),this.startConnecting(),this.setUnavailableTimer())}send(t){return!!this.connection&&this.connection.send(t)}sendCommand(t,n){return!!this.connection&&this.connection.sendCommand(t,n)}sendJoin(t){return this.connection&&this.connection.sendJoin(t),!1}sendLeave(t){return this.connection&&this.connection.sendLeave(t),!1}disconnect(){this.disconnectInternally(),this.updateState(s.DISCONNECTED)}isConnected(){return this.state===s.CONNECTED}startConnecting(){this.runner=this.transport.connect((t,n)=>{t?(this.abandonConnection(),this.shouldRetry(t)&&this.retryIn(this.options.retryTimeout||0),this.emit(s.CLOSED,t)):(this.abortConnecting(),this.clearUnavailableTimer(),this.setConnection(n),this.updateState(s.CONNECTED))})}abortConnecting(){this.runner&&(this.runner.abort(),this.runner=null)}disconnectInternally(){if(this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection){const t=this.abandonConnection();t&&t.close()}}retryIn(t){t>0&&this.emit(s.CONNECTING,{type:m.CONNECTING,data:String(Math.round(t/1e3)),error:null}),this.retryTimer=setTimeout(()=>{this.disconnectInternally(),this.connect()},t||0)}clearRetryTimer(){this.retryTimer&&(this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=0)}setUnavailableTimer(){this.unavailableTimer=setTimeout(()=>{this.updateState(s.UNAVAILABLE)},this.options.unavailableTimeout)}clearUnavailableTimer(){this.unavailableTimer&&clearTimeout(this.unavailableTimer),this.unavailableTimer=0}buildConnectionCallbacks(t){return{...t,message:t=>{this.emit(s.MESSAGE,t)},error:t=>{this.emit(s.ERROR,t)},closed:t=>{this.abandonConnection(),this.shouldRetry(t)&&this.retryIn(this.options.retryTimeout||0),this.emit(s.CLOSED,t)},channelJoined:t=>this.emit(s.CHANNEL_JOINED,t),channelJoinFailed:t=>this.emit(s.CHANNEL_JOIN_FAILED,t),channelLeft:t=>this.emit(s.CHANNEL_LEFT,t)}}buildErrorCallbacks(){const t=t=>n=>{n.error&&this.emit(s.ERROR,{type:m.ERROR,data:null,error:n.error}),t(n)};return{refused:t(()=>{this.disconnect()}),unavailable:t(()=>{this.retryIn(1e3)})}}setConnection(t){this.connection=t,this.connection&&(this.connection.bind(s.MESSAGE,this.connectionCallbacks.message),this.connection.bind(s.CHANNEL_LEFT,this.connectionCallbacks.channelLeft),this.connection.bind(s.CHANNEL_JOIN_FAILED,this.connectionCallbacks.channelJoinFailed),this.connection.bind(s.CHANNEL_JOINED,this.connectionCallbacks.channelJoined),this.connection.bind(s.ERROR,this.connectionCallbacks.error),this.connection.bind(s.CLOSED,this.connectionCallbacks.closed))}abandonConnection(){if(!this.connection)return null;this.connection.unbind(s.MESSAGE,this.connectionCallbacks.message),this.connection.unbind(s.CHANNEL_LEFT,this.connectionCallbacks.channelLeft),this.connection.unbind(s.CHANNEL_JOIN_FAILED,this.connectionCallbacks.channelJoinFailed),this.connection.unbind(s.CHANNEL_JOINED,this.connectionCallbacks.channelJoined),this.connection.unbind(s.ERROR,this.connectionCallbacks.error),this.connection.unbind(s.CLOSED,this.connectionCallbacks.closed);const{connection:t}=this;return this.connection=null,t}updateState(t){const n=this.state;this.state=t,n!==t&&this.emit(t,void 0)}shouldRetry(t){return this.state===s.CONNECTING||this.state===s.CONNECTED}}var m;!function(t){t.CONNECTING=\"sfSocket:connecting\",t.MESSAGE=\"sfSocket:message\",t.CHANNEL_JOINED=\"channel_joined\",t.CHANNEL_JOIN_FAILED=\"channel_join_failed\",t.CHANNEL_LEFT=\"channel_left\",t.CHANNEL_LEAVE_FAILED=\"channel_leave_failed\",t.ERROR=\"sfSocket:error\",t.CLOSED=\"sfSocket:closed\"}(m||(m={}));class f{constructor(t){if(this.channels={},!t||\"object\"!=typeof t)throw new Error(\"sfSocket options should be an object\");const n=t||{};this.config={...c,port:n.useTLS?443:80,...n},this.cMgr=new O(this.config),this.cMgr.bind(s.CONNECTED,()=>{Object.values(this.channels).forEach(t=>{t.join()})}),this.cMgr.bind(s.ERROR,t=>{console.error(t)}),f.instances.push(this),f.isReady&&this.connect()}static ready(){f.isReady=!0,f.instances.forEach(t=>{t.connect()})}connect(){this.cMgr.connect()}disconnect(){this.cMgr.disconnect()}sendCommand(t,n){return this.cMgr.sendCommand(t,n)}joinChannelList(t){t.forEach(t=>{this.joinChannel(t)})}leaveChannelList(t){t.forEach(t=>{this.leaveChannel(t)})}subscribe(t,n,e){return this.cMgr.bind(t,n,e)}unsubscribe(t,n,e){return this.cMgr.unbind(t,n,e)}joinChannel(t,n=!1){if(this.channels[t])throw new Error(`Channel ${t} already exists`);return this.channels[t]=new a(t,this),n||this.channels[t].join(),this.channels[t]}leaveChannel(t){if(!this.channels[t])throw new Error(`Channel ${t} does not exist`);const n=this.channels[t];return n.leave(),delete this.channels[t],n}getChannel(t){return this.channels[t]}}f.instances=[],f.isReady=!1,e.d(n,\"makeSocketOptions\",(function(){return y})),e.d(n,\"SFSocket\",(function(){return f})),e.d(n,\"eventNames\",(function(){return s}));const y=t=>{const n=new URL(t),e=n.protocol?n.protocol.replace(\":\",\"\"):null;return n.hostname&&n.port&&e?{host:n.hostname,port:n.port,path:e}:null};n.default=f}])}));\n//# sourceMappingURL=socket.js.map","import sf, { IOptionToGrab, ISpiralFramework } from '@spiral-toolkit/core';\nimport { SFSocket } from '@spiralscout/websockets';\nimport { EVENT_NAME } from './constants';\nimport { toastTemplate } from './item';\nimport {\n  INCenterOptions, INCenterUiElements, INotification, INotificationEvent,\n} from './types';\n\nexport function isNotificationEvent(e: any): e is INotificationEvent {\n  if (e.type !== EVENT_NAME || !e.data) {\n    return false;\n  }\n  if (e.data.title && e.data.id && e.data.body) {\n    return true;\n  }\n  return false;\n}\n\nexport class Notifications extends sf.core.BaseDOMConstructor {\n  static readonly spiralFrameworkName: string = 'notifications';\n\n  static readonly spiralFrameworkCssName: string = 'js-sf-notifications-dyn';\n\n  static readonly defaultOptions: INCenterOptions = {\n    drawer: {\n      container: '.js-sf-notifications',\n      body: '.js-sf-notifications-body',\n      counter: '.js-sf-notifications-count',\n      mask: '.js-sf-notifications-mask',\n      btn: '.js-sf-notifications-button',\n    },\n    header: {\n      toggle: '.js-sf-notifications-toggle',\n      counter: '.js-sf-notifications-counter',\n    },\n    api: {\n      getList: '/api/notifications',\n      setAsRead: '/api/notifications/read',\n    },\n    ws: false,\n  };\n\n  public ui: INCenterUiElements;\n\n  public options: INCenterOptions = { ...Notifications.defaultOptions };\n\n  public readonly name = Notifications.spiralFrameworkName;\n\n  public readonly optionsToGrab: { [option: string]: IOptionToGrab } = {};\n\n  public ws?: SFSocket;\n\n  private data: Array<INotification> = [];\n\n  private unreadCount: number = 0;\n\n  private selected: Set<string> = new Set<string>();\n\n  private toastTemplate: (item: INotification) => string;\n\n\n  constructor(ssf: ISpiralFramework, node: Element, options: INCenterOptions) {\n    super();\n    this.init(ssf, node, options);\n    this.options = {\n      ...Notifications.defaultOptions,\n      ...this.options,\n    };\n    this.toastTemplate = sf.helpers.template.compile(toastTemplate);\n    this.ui = {\n      drawer: {\n        body: document.querySelector(this.options.drawer.body) as HTMLElement,\n        container: document.querySelector(this.options.drawer.container) as HTMLElement,\n        counter: document.querySelector(this.options.drawer.counter) as HTMLElement,\n        mask: document.querySelector(this.options.drawer.mask) as HTMLElement,\n        btn: document.querySelector(this.options.drawer.btn) as HTMLElement,\n      },\n      header: {\n        counter: document.querySelector(this.options.header.counter) as HTMLElement,\n        toggle: document.querySelector(this.options.header.toggle) as HTMLElement,\n      },\n    };\n    this.initWs();\n    this.bindEvents();\n    this.reload();\n  }\n\n  toggleDrawer() {\n    this.ui.drawer.container.classList.toggle('drawer-open');\n  }\n\n  bindEvents() {\n    this.toggleDrawer = this.toggleDrawer.bind(this);\n    this.markSelection = this.markSelection.bind(this);\n    this.ui.header.toggle.addEventListener('click', this.toggleDrawer);\n    this.ui.drawer.mask.addEventListener('click', this.toggleDrawer);\n    this.ui.drawer.btn.addEventListener('click', this.markSelection);\n  }\n\n  unbindEvents() {\n    this.ui.header.toggle.removeEventListener('click', this.toggleDrawer);\n  }\n\n  calcSelected() {\n    [...this.selected.values()].forEach((v) => {\n      if (!this.data.find((n) => n.id === v)) {\n        this.selected.delete(v);\n      }\n    });\n  }\n\n  updateButton() {\n    let text = 'Mark All As Read';\n    if (this.selected.size && this.selected.size < this.data.length) {\n      text = `Mark ${this.selected.size} As Read`;\n    }\n    this.ui.drawer.btn.innerHTML = text;\n  }\n\n  initWs() {\n    if (this.options.ws) {\n      if (typeof (this.options.ws) === 'string') {\n        this.ws = (window as any)[this.options.ws] as SFSocket;\n      } else {\n        this.ws = new SFSocket(this.options.ws);\n      }\n      if (this.ws) {\n        this.ws.subscribe('message' as any, (event) => {\n          try {\n            const e = JSON.parse(event.data || '');\n            if (isNotificationEvent(e)) {\n              const { data } = e;\n              this.onNotification(data);\n            }\n            // eslint-disable-next-line no-empty\n          } catch (ex) {\n          }\n        });\n      }\n    }\n  }\n\n  onNotification(n: INotification) {\n    const existing = this.data.findIndex((val) => val.id === n.id);\n    if (n.icon) {\n      // eslint-disable-next-line no-param-reassign\n      n.title = `<i class=\"fas fa-${n.icon}\"></i>&nbsp;${n.title}`;\n    }\n    if (existing >= 0) {\n      this.data[existing] = n;\n    } else {\n      this.data = [n, ...this.data].sort((val) => (val.date || 0));\n    }\n    this.unreadCount = this.data.filter((v) => !v.read).length;\n    this.calcSelected();\n\n    const event = new CustomEvent('sf:notification-show', {\n      bubbles: true,\n      detail: {\n        message: `<div>${n.title}&nbsp;&nbsp;<small class=\"float-right\">${this.date(n.date)}</small><hr class=\"mx-0 my-1\"/>${n.body}</div>`,\n        type: 'primary',\n        position: 'tr',\n        timeout: 2000,\n        onClick: this.toggleDrawer,\n      },\n    });\n    document.dispatchEvent(event);\n\n    this.render();\n  }\n\n  reload() {\n    sf.ajax.send({\n      method: 'GET',\n      url: this.options.api.getList,\n    }).then((axResp) => {\n      const { data } = axResp;\n      this.handleResponse(data);\n    });\n  }\n\n  handleResponse(data: any) {\n    this.unreadCount = data.unreadCount || this.unreadCount;\n    this.data = data.data || this.data;\n    this.calcSelected();\n    this.render();\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  date(n: number) {\n    return n ? sf.helpers.luxon.DateTime.fromJSDate(new Date(n)).toFormat('HH:mm yyyy-MM-dd') : '';\n  }\n\n  renderNotitifation(not: INotification & { selected: boolean }) {\n    const date = this.date(not.date);\n    const item = this.toastTemplate({ ...not, date: date as any });\n    const fr = document.createElement('div');\n    fr.innerHTML = item;\n    const el = fr.firstChild! as HTMLElement;\n    this.bindToast(el, not);\n    if (not.read) {\n      el.classList.add('d-none');\n    }\n    return el;\n  }\n\n  render() {\n    this.ui.header.counter.innerText = this.unreadCount.toString();\n    this.ui.header.counter.classList.toggle('d-none', !this.unreadCount);\n    this.ui.drawer.counter.innerText = this.unreadCount.toString();\n    this.ui.drawer.counter.classList.toggle('d-none', !this.unreadCount);\n\n    this.ui.drawer.body.innerHTML = '';\n    this.data.forEach((not) => {\n      const el = this.renderNotitifation({ ...not, selected: this.selected.has(not.id) });\n      this.ui.drawer.body.appendChild(el);\n    });\n    this.updateButton();\n  }\n\n  bindToast(el: HTMLElement, not: INotification) {\n    const closeBtn = el.querySelector('[data-dismiss]')!;\n    closeBtn.addEventListener('click', () => {\n      this.markAsRead(not, el);\n    });\n    const input: HTMLInputElement = el.querySelector('input') as HTMLInputElement;\n    input.addEventListener('change', () => {\n      if (input.checked) {\n        this.selected.add(not.id);\n      } else {\n        this.selected.delete(not.id);\n      }\n      this.updateButton();\n    });\n  }\n\n  die() {\n    this.unbindEvents();\n  }\n\n  private markAsRead(not: INotification, el: HTMLElement) {\n    // eslint-disable-next-line no-param-reassign\n    not.read = true;\n    el.classList.toggle('show');\n    this.unreadCount = this.data.filter((v) => !v.read).length;\n\n    sf.ajax.send({\n      method: 'POST',\n      data: { id: not.id },\n      url: this.options.api.setAsRead,\n    }).then((axResp) => {\n      const { data } = axResp;\n      this.handleResponse(data);\n    }).catch(() => {\n      this.reload();\n    });\n  }\n\n  markSelection() {\n    let ids = this.data.map((v) => v.id);\n    if (this.selected.size && this.selected.size < ids.length) {\n      ids = [...this.selected.values()];\n    }\n    sf.ajax.send({\n      method: 'POST',\n      data: { id: ids },\n      url: this.options.api.setAsRead,\n    }).then((axResp) => {\n      const { data } = axResp;\n      this.handleResponse(data);\n    }).catch(() => {\n      this.reload();\n    });\n  }\n}\n","export const toastTemplate = `<div class=\"toast show\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\">\n    <div class=\"toast-header\">\n         <div class=\"custom-control custom-checkbox mr-auto\">\n          <input type=\"checkbox\" class=\"custom-control-input\" id=\"sf-notification-{{id}}\" {{#if selected}}checked=\"checked\"{{/if}}>\n          <label class=\"custom-control-label\" for=\"sf-notification-{{id}}\">{{{title}}}</label>\n        </div>\n        <small>{{date}}</small>\n        <button type=\"button\" class=\"ml-2 mb-1 close\" data-dismiss=\"toast\" aria-label=\"Close\">\n            <span aria-hidden=\"true\">&times;</span>\n        </button>\n    </div>\n    <div class=\"toast-body\">\n        {{{body}}}\n    </div>\n</div>`;\n","export const EVENT_NAME = 'notification';\n","import sf from '@spiral-toolkit/core';\nimport { Notifications } from './Notifications';\n\nsf.registerInstanceType(Notifications, Notifications.spiralFrameworkCssName);\n\n// Includes version and time in bundle\nexport const version = `Version ${process.env.VERSION}, built at ${process.env.BUILD_TIME}`\n\nexport default Notifications; // ES6 default export will not expose us as global\n"],"sourceRoot":""}